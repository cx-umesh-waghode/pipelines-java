parameters:
- name: cxService
  type: string
  default: SAST-Bug

variables:
- name: debug
  value: true 
pool:
#  name: Default
   vmImage: 'ubuntu-20.04'
  
steps:
- script: |
    curl -L "https://sca-downloads.s3.amazonaws.com/cli/latest/ScaResolver-linux64.tar.gz" -o "ScaResolver.tar.gz" && tar -vxzf ScaResolver.tar.gz && sudo mv ScaResolver /usr/local/bin && rm Configuration.ini ScaResolver.tar.gz

- script: |
    ls -lart /usr/local/bin
    
- bash: echo '-s $(Build.SourcesDirectory) -n meinaral-app-pipeline -r $(Agent.BuildDirectory)'    
- task: checkmarx.cxsast.cx-scan-task.Application security testing@2022
  displayName: 'Application security testing'
  inputs:
      projectName: meinaral-app-pipeline$(Agent.Name)
      syncMode: true
      enableProxy: false
      enableSastScan: false
      enableDependencyScan: true
      dependencyServerURL: SCA-Recall
      dependencyAccessControlURL: 'https://platform.checkmarx.net'
      dependencyWebAppURL: 'https://sca.checkmarx.net'
      includeSource: false
      dependencyFolderExclusion: 'cvs,.svn,.hg,.git,.bzr,bin,obj,backup,.idea,node_modules'
      dependencyTenant: BP
      scaVulnerabilityThreshold: false
      pathToScaResolver: '/usr/local/bin'
      isEnableScaResolver: true
      scaResolverAddParameters: '-s $(Build.SourcesDirectory) -n meinaral-app-pipeline -r $(Agent.BuildDirectory)'
      scaHigh: ' '
      scaMedium: ' '
      scaLow: ' '
      scaTeam: 'CxServer/'